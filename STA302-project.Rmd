---
title: "STA302-project"
output: html_document
date: "2024-08-05"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}
install.packages("MASS")
install.packages("gapminder")
install.packages("leaps")
install.packages("usdm")
install.packages("car")
install.packages("corrplot")
install.packages("texreg")
install.packages("MPV")
install.packages("faraway")
install.packages("lmtest")
install.packages("nortest")

library(dplyr)
library(gapminder)
library(leaps)
library(glmnet)
library(ggplot2)
library(MASS)
library(usdm)
library(car)
library(corrplot)
library(texreg)
library(MPV)
library(faraway)
library(lmtest)
library(nortest)
```


```{r}
#Assigning the dataset to variable epl
epl <- read.csv("epl_data.csv")

#Selecting variables of interest and creating a matrix with just those values
eplFiltered <- epl %>% select_(6, 7, 8, 9, 10, 20, 24, 27, 28, 29, 40, 41, 43, 44, 56, 57, 58, 59)
head(eplFiltered)

#Removing all NA values, leaves us with 501 observations
eplWoNa <- na.omit(eplFiltered)
nrow(eplWoNa)
```

```{r}
#Conducting variable selection using AIC

#Fitting a model using all variables
modAll <- lm(Appearances ~ Age + Wins + Losses + Goals + Hit.woodwork + Tackles + 
              Blocked.shots + Interceptions + Clearances + Assists + Passes + Big.chances.created +
              Crosses + Yellow.cards + Red.cards + Fouls + Offsides, data = eplWoNa)
#Taking a look at the model
summary(modAll)

#Checking the value of AIC for the model with all variables
AIC(modAll)

#Creating an intercept only model
mod0 <- lm(Appearances ~ 1, data = eplWoNa)
AIC(mod0)
summary(mod0)$r.squared
```

```{r}
#Conducting backward elimination on the full model (modAll)
bmod <- stepAIC(object = modAll, direction = "backward")
coef(bmod)

#Checking the adjusted R-squared after the variable selection (backward)
summary(bmod)$adj.r.squared

#Conducting forward elimination on the empty model, full model as scope
fmod <- stepAIC(object = mod0, direction = "forward", scope = formula(modAll), trace = FALSE)
coef(fmod)

#Checking the adjusted R-squared after the variable selection (forward)
summary(fmod)$adj.r.squared

#Both methods select the same variables :)


#This shows that the AIC decreases with each added variable
bmod$anova
fmod$anova
```

```{r}
#Partial F-test

#The best model given by both forwards and backwards methods
optimodel <- lm(Appearances ~ Wins + Losses + Tackles + Crosses + Clearances + 
                  Offsides + Big.chances.created + Assists + Blocked.shots + 
                  Goals, data = eplWoNa)
#Second best forward method model
fSecondBest <- lm(Appearances ~ Wins + Losses + Tackles + Crosses + Clearances + 
                    Offsides + Big.chances.created + Assists + 
                    Blocked.shots, data = eplWoNa)
#Second best backward method model
bSecondBest <- lm(Appearances ~ Wins + Losses + Goals + Hit.woodwork + Tackles + 
                    Blocked.shots + Clearances + Assists + Big.chances.created + 
                    Crosses + Offsides, data = eplWoNa)

#The output gives Pr(>F) = 0.01754, we reject null hypothesis, decide to keep new variable
anova(optimodel, fSecondBest)

#The output gives Pr(>F) = 0.222, we cannot reject null hypothesis, decide to remove excess variable
anova(optimodel, bSecondBest)

#The two partial F tests above, along with our stepAIC variable selection allow us to conclude -
#optimodel is the best model for the given data
```
```{r}
#Assumption Checking

#Residuals do not appear normal looking at the Q-Q plot produced here
plot(optimodel)

```
